clear

: block
  0xf0

: user
  0xff
  
: ball
  0x80
  

: main
  vd := 2 # x position
  vc := 2 # y position
  i := block

  loop
    if vc == 18 then jump game
    sprite vd vc 1
    vd += 5
    if vd >= 59 begin
    vd := 2
    vc += 2
    end
  again
  
  : game
    # draw ball starting position
    :alias ballx v3
    ballx := 32 # ball x position
    :alias bally v4
    bally := 20 # ball y position
    :alias dirx v5
    dirx := 1 # ball x direction
    :alias diry v6
    diry := -1 # ball y direction
    i := ball
    sprite ballx bally 1
    
    # paddle starting position
    :alias paddlex v0
    v0 := 28
    :alias paddley v1
    v1 := 29
    i := user
    sprite paddlex paddley 1
    
    loop # main game loop
      updateBall
      if vf != 0 then updateBricks
      updatePaddle
    again
    
    
####################################################

: updateBall
  i := ball
  sprite ballx bally 1
  if bally == 31 then reset
  if ballx == 63 then dirx := -1
  if ballx == 0 then dirx := 1
  if bally == 0 then diry := 1

  ballx += dirx
  bally += diry
  sprite ballx bally 1
  return

   
: updatePaddle
  
  i := user
  sprite paddlex paddley 1
  v7 := 4
  if v7 key then v0 += -1
  v8 := 6
  if v8 key then v0 += 1
  paddlex := v0
  paddley := v1
  sprite paddlex paddley 1
  return


: reset
  bally := 28
  ballx := 32
  dirx := 1
  diry := -1
  return
  
: reverse
  diry := -1
  dirx := 1
  return

: updateBricks
  if bally == 29 then updateDirection
  return
  
: updateDirection
  diry := -1
  if dirx == 1 begin
    dirx := 1
  else
    dirx := -1
  end
  
  return