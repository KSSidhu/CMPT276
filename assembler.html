
<html>

<head>
    <input type="file" id="files" name="files[]" multiple />
    <output id="list"></output>
    <br>
    <!-- <button id = "upload" onclick="readFile()">UPLOAD</button> -->
    <br> <br>


    <style>

        body {
            margin: 0%;
        }

        @font-face {
            font-family: "CG";
            src: url(./resources/CENTURYGOTHIC.ttf) format("truetype");
        }

        textarea {
            height: 10%;
            width: 20%;
        }

        button {
            text-transform: capitalize;
        }

    </style>
</head>


<body>
    <textarea id="textbox"></textarea><br><br>
    <button id="create">SAVE TO FILE</button>
    <a download="notes.txt" id="downloadlink" style="display: none"><button onclick="functionreset()">DOWNLOAD</button></a>
    <br>
    
    <script>
        
        //Declaring textfile input variables
        var values;
        var mneumonic;
        var NNN;
        var NN;
        var N;
        var r1;
        var r2;
        
        //Reading the file 
        function readFile(evt) {
            
            var files = evt.target.files; // FileList object
            file = files[0];

            var reader = new FileReader();
            
            reader.onload = function(){

                var text = reader.result;
                var lines = text.split('\r\n');
                //alert(lines.length);

                for(var i=0; i<lines.length; i++){
                    if(lines[i].trim().charAt(0) == "#" || lines[i].trim().length == 0) {
                        continue;
                    } else {
                        console.log(lines[i]);
                        values = lines[i].split(' ');
                    }
                    mneumonic = values[0];
                    processText();
                    
                }
                console.log("Done");
            };
            //alert("start");
            reader.readAsText(file);
        }

        //OUTPUT
        
        //Editing the text box 
        function processText() {
            //alert("say");
            var textFile = null,
                makeTextFile = function(text) {
                    var data = new Blob([text], {
                        type: 'text/plain'
                    });

                    // If we are replacing a previously generated file we need to
                    // manually revoke the object URL to avoid memory leaks.
                    if (textFile !== null) {
                        window.URL.revokeObjectURL(textFile);
                    }

                    textFile = window.URL.createObjectURL(data);

                    return textFile;
                };

            var create = document.getElementById('create');
            switch (mneumonic){
                case "CLS":
                    textbox = document.getElementById("textbox").value += "0x00E0";
                    alert(textbox);
                    break;

                case "RTS" :
                    textbox = document.getElementById("textbox").value += "0x00EE";
                    break;

                case "SYS":
                    NNN = values[1]; 
                    textbox = document.getElementById("textbox").value += "0x0" + NNN;
                    break;

                case "JUMP":
                    NNN = values[1];
                    textbox = document.getElementById("textbox").value += "0x1" + NNN;
                    break;

                case "CALL":
                    NNN = values[1];
                    textbox = document.getElementById("textbox").value += "0x2" + NNN;
                    break;

                case "SKE":
                    r1 = values[1];
                    NN = values[2];

                    textbox = document.getElementById("textbox").value += "0x3" + r1 + NN;
                    break;

                case "SKNE":
                    r1 = values[1];
                    NN = values[2];

                    var create = document.getElementById('create'),textbox = document.getElementById("textbox").value += "0x4" + r1 + NN;
                    break;


                case "SKR":
                    r1 = values[1];
                    r2 = values[2];

                    var create = document.getElementById('create'),textbox = document.getElementById("textbox").value += "0x5" + r1 + r2 + "0";
                    break;

                case "LOAD":
                    r1 = values[1];
                    NN = values[2];

                    var create = document.getElementById('create'),textbox = document.getElementById("textbox").value += "0x6" + r1 + NN;
                    break;
                    

                case "ADD":
                    r1 = values[1];
                    NN = values[2];

                    var create = document.getElementById('create'),textbox = document.getElementById("textbox").value += "0x7" + r1 + NN;
                    break;

                case "MOVE":
                    r1 = values[1];
                    r2 = values[2];

                    var create = document.getElementById('create'),textbox = document.getElementById("textbox").value += "0x8" + r1 + r2 + 0;
                    break;

                case "OR":
                    r1 = values[1];
                    r2 = values[2];

                    var create = document.getElementById('create'),textbox = document.getElementById("textbox").value += "0x8" + r1 + r2 + 1;
                    break;

                case "AND":
                    r1 = values[1];
                    r2 = values[2];

                    var create = document.getElementById('create'),textbox = document.getElementById("textbox").value += "0x8" + r1 + r2 + 2;
                    break;

                case "XOR":
                    r1 = values[1];
                    r2 = values[2];

                    var create = document.getElementById('create'),textbox = document.getElementById("textbox").value += "0x8" + r1 + r2 + 3;
                    break;

                case "ADDR":
                    r1 = values[1];
                    r2 = values[2];

                    var create = document.getElementById('create'),textbox = document.getElementById("textbox").value += "0x8" + r1 + r2 + 4;
                    break;

                ///STOPS WORKING AFTER HERE
                case "SUB":
                    r1 = values[1];
                    r2 = values[2];

                    var create = document.getElementById('create'),textbox = document.getElementById("textbox").value += "0x8" + r1 + r2 + 5;
                    break;

                case "SHR":
                    r1 = values[1];

                    var create = document.getElementById('create'),textbox = document.getElementById("textbox").value += "0x8" + r1 + 0 + 6;
                    break;

                case "SHL":
                    r1 = values[1];

                    var create = document.getElementById('create'),textbox = document.getElementById("textbox").value += "0x8" + r1 + 0 + "E";
                    break;

                case "SKNE":
                    r1 = values[1];
                    r2 = values[2];

                    var create = document.getElementById('create'),textbox = document.getElementById("textbox").value += "0x9" + r1 + r2 + 0;
                    break;

                case "LOADI":
                    NNN = values[1];

                    var create = document.getElementById('create'),textbox = document.getElementById("textbox").value += "0xA" + NNN;
                    break;

                case "JUMPI":
                    NNN = values[1];

                    var create = document.getElementById('create'),textbox = document.getElementById("textbox").value += "0xB" + NNN;
                    break;

                case "RND":
                    r1 = values[1];
                    NN = values[2];

                    var create = document.getElementById('create'),textbox = document.getElementById("textbox").value += "0xC" + r1 + NN;
                    break;

                case "DRW":
                    r1 = values[1];
                    r2 = values[2];
                    N = values[3];

                    var create = document.getElementById('create'),textbox = document.getElementById("textbox").value += "0xD" + r1 + r2 + N;
                    break;

                case "SKPR":
                    r1 = values[1];

                    var create = document.getElementById('create'),textbox = document.getElementById("textbox").value += "0xE" + r1 + 9 + "E";
                    break;

                case "SKNP":
                    r1 = values[1];

                    var create = document.getElementById('create'),textbox = document.getElementById("textbox").value += "0xE" + r1 + "A" + 1;
                    break;

                case "MOVED":
                    r1 = values[1];

                    var create = document.getElementById('create'),textbox = document.getElementById("textbox").value += "0xF" + r1 + 0 + 7;
                    break;

                case "KEYD":
                    r1 = values[1];

                    var create = document.getElementById('create'),textbox = document.getElementById("textbox").value += "0xF" + r1 + 0 + "A";
                    break;

                case "LOADD":
                    r1 = values[1];

                    var create = document.getElementById('create'),textbox = document.getElementById("textbox").value += "0xF" + r1 + 1 + 5;
                    break;

                case "LOADS":
                    r1 = values[1];

                    var create = document.getElementById('create'),textbox = document.getElementById("textbox").value += "0xF" + r1 + 1 + 8;
                    break;

                case "ADDI":
                    r1 = values[1];

                    var create = document.getElementById('create'),textbox = document.getElementById("textbox").value += "0xF" + r1 + 1 + "E";
                    break;

                case "LDSPR":
                    r1 = values[1];

                    var create = document.getElementById('create'),textbox = document.getElementById("textbox").value += "0xF" + r1 + 2 + 9;
                    break;

                case "BCD":
                    r1 = values[1];

                    var create = document.getElementById('create'),textbox = document.getElementById("textbox").value += "0xF" + r1 + 3 + 3;
                    break;

                case "STOR":
                    r1 = values[1];

                    var create = document.getElementById('create'),textbox = document.getElementById("textbox").value += "0xF" + r1 + 5 + 5;
                    break;

                case "READ":
                    r1 = values[1];

                    var create = document.getElementById('create'),textbox = document.getElementById("textbox").value += "0xF" + r1 + 6 + 5;
                    break;

            }
            textbox = document.getElementById("textbox").value += '\n';

            create.addEventListener('click', function() {
                var link = document.getElementById('downloadlink');
                console.log(textbox);
                link.href = makeTextFile(textbox);
                link.style.display = 'block';
                document.getElementById('create').style.display = 'none';
            }, false);
        };

        function functionreset() {
            var link = document.getElementById('downloadlink');
            link.style.display = 'none';
            document.getElementById('create').style.display = 'block';
        }

    </script>

    <script>
         document.getElementById("files").addEventListener('change', readFile, false)
         document.getElementById("textbox").onchange = function() {functionreset()}
    </script>

    

<!-- REFERENCES: 

    https://stackoverflow.com/questions/52792178/i-want-to-save-textbox-to-txt-file-in-html-using-javascript-but-i-have-an-error?fbclid=IwAR3imyhtf-nizrShgFY1RA1H7CQyIk7_ZgAb2P1kLIjIQePSTCFvUdnj-J0-->

</body></html>
